<!DOCTYPE html>
<html>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <script>
    function setData(){
      let month = document.getElementById('months').value;
      google.script.run.withSuccessHandler(function(arg){
//        console.log(arg);
        document.getElementById('data').value = arg;
      }).getBudgetData(month);
    }
    
    function getData(month){
      return document.getElementById('data').value;
    }
  </script>
  <head>
    <base target="_top">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css">
  </head>
  <body>
      <spam id="data"></spam>
      <table class="table table-dark table-striped" id="table">
        <thead>
          <th scope="col">Line Item</th>
          <th scope="col">Amount</th>
          <th scope="col">Last Month</th>
          <th scope="col">This Month</th>
          <th scope="col">Balance</th>
        </thead>
        <tbody>
          <script>
              $("tbody").empty();
              let month = "March"
              if( month === "" ){
                google.script.host.close();
              }
//              console.log(month);
              let data = getData(month);
//              console.log("buildTable: " + data);
              for( let i = 0; i < data.length; i++ ){
                let tr = $("<tr>");
                for( let j = 0; j < data[i].length; j++ ){
                  let td = $("<td>");
//                  td.scope("col");
                  let value = data[i][j];
//                  if( typeof value === "number" ) value += value.toFixed(2);
//                  console.log("[" + i + "][" + j + "] = " + value);
                  if( (typeof value) === "string" ){
                    let negCheck = value.search("-");
                    let regexp = /(\d+)(\.)/g;
                    let match = [...value.matchAll(regexp)];
//                    console.log("regex results: " + match.length);
                    if( match.length > 0 && negCheck > -1 ){
                      value = value.replace("-", "");
                      td.text("-$" + value);
                    } else if( match.length > 0 && negCheck === -1 ){
                      td.text("$" + value);
                    } else {
                      td.text(value);
                    }
                  } else {
                    if( value < 0 ){
                      value *= -1;
                      td.text("-$" + value);
                    } else {
                      td.text("$" + value);
                    }
                  }
                  tr.append(td);
                }
                $("tbody").append(tr);
              }
          </script>
        </tbody>
      </table>
  </body>
</html>
